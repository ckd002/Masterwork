<html>
  <head>
  	<title>Masterwork Project</title>
  	<style type="text/css">
  		body {background-color: DeepSkyBlue;
  			  color: DeepPink;}
  		
  	</style>
  	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  	
  	<script language="javascript">
  		function getXMLHttpReq()
			{ var req = null;
			
			if (window.XMLHttpRequest)
			   req = new XMLHttpRequest();
			else if (window.ActiveXObject)
			   req = new ActiveXObject(Microsoft.XMLHTTP);
			return req;
			}
			
		function addNode()
			{ var req = getXMLHttpReq();
			
			var studentName=document.getElementById("student").value;
			var email=document.getElementById("email").value;
			var className=document.getElementById("class").value;
			var prof=document.getElementById("professor").value;
			var book=document.getElementById("book").value;
			
			dataStr= '{"Student": "' + studentName + '","Email": "' + email + '", "Class": "' 
				+ className + '", "Professor": "' + prof + '", "Book": "' + book + '"}'
			if (req==null)
				return 1;
			
			req.open("Post", "http://localhost:7474/db/data/node", true);
			
			req.onreadystatechange = function()
			   {
			   if(req.readyState == 4)
				  {
				  if(req.status == 200)
					 document.getElementById('rmakechanges').innerHTML = req.responseText;
				  else
					 document.getElementById('makechanges').innerHTML = "Error Status: " + 
					req.status + "<br />Error Description: " + req.statusText;
				  }
			   }
			
			req.setRequestHeader("Content-type", "application/json");
			req.send(dataStr);
			return 0;
			
			}
			
		function getNode()
			{ var req = getXMLHttpReq();

			var nodeId=document.getElementById("get").value
			var url='http://localhost:7474/db/data/node/' + nodeId

			if (req==null)
				return 1;

			req.open("GET", url, true);

			req.onreadystatechange = function()
			   {
			   if(req.readyState == 4)
				  {
				  if(req.status == 200)
					 document.getElementById('makechanges').innerHTML = req.responseText;
				  else
					 document.getElementById('makechanges').innerHTML = "Error Status: " + 
					req.status + "<br />Error Description: " + req.statusText;
				  }
			   }

			req.setRequestHeader("Content-type", "application/json");
			req.send();
			return 0;

			}
			
		function delNode(url)
			{ var req = getXMLHttpReq();
		
			if (req==null)
				return 1;
			
			req.open("DELETE", url, true);
			
			req.onreadystatechange = function()
			   {
			   if(req.readyState == 4)
				  {
				  if(req.status == 204)
					 document.getElementById('displaybooks').innerHTML =  "Bood Successfully Deleted";
				  else
					 document.getElementById('displaybooks').innerHTML = "Error Status: " + 
					req.status + "<br />Error Description: " + req.statusText;
				  }
			   }
			
			req.setRequestHeader("Content-type", "application/json");
			req.send();
			return 0;
			
			}
			
		function queryGraph(query)
			{
			var book=document.getElementById('booktofind').value;
			$.ajax({
				type:"POST",
				url: "http://localhost:7474/db/data/cypher",
				accepts: "application/json",
				dataType:"json",
				data:{
					"query" : "start n= node(*) where n.Book= '" + book + "' return n;",
					"params" : {}
				},
				success: function(data, textStatus, jqXHR)
					{
					displayResults(data);
					},
				error:function(jqXHR, textStatus, errorThrown){
 				alert(textStatus);}
 			});//end of placelist ajax
 			
 			}
			
		function showNodes()
			{
			$.ajax({
				type:"POST",
				url: "http://localhost:7474/db/data/cypher",
				accepts: "application/json",
				dataType:"json",
				data:{
					"query" : "start root= node(*) return root;",
					"params" : {}
				},
				success: function(data, textStatus, jqXHR)
					{
					displayResults(data);
					
					},
				error:function(jqXHR, textStatus, errorThrown){
 				alert(textStatus);}
 			});//end of placelist ajax
			
			}
			
		function getbyname()
			{
			var sname=document.getElementById("findstudent").value;
			$.ajax({
				type:"POST",
				url: "http://localhost:7474/db/data/cypher",
				accepts: "application/json",
				dataType:"json",
				data:{
					"query" : "start n= node(*) where n.Student= '" + sname + "'return n;",
					"params" : {}
				},
				success: function(data, textStatus, jqXHR)
					{
					displayResults(data);
					
					},
				error:function(jqXHR, textStatus, errorThrown){
 				alert(textStatus);}
 			});//end of placelist ajax
			
			}
			
		function displayResults(data)
			{
			var table = "<table border=1>";
			table+= "<tr><th>Name</th><th>Email</th><th>Professor</th><th>Class</th><th>Book</th></tr>"
			
			for (var i=0, len=data.data.length; i < len; i++)
				{
				table+= "<tr>";
				table+= "<td>" + data.data[i][0].data.Student + "</td>";
				table+= "<td>" + data.data[i][0].data.Email + "</td>";
				table+= "<td>" + data.data[i][0].data.Professor + "</td>";
				table+= "<td>" + data.data[i][0].data.Class + "</td>";
				table+= "<td>" + data.data[i][0].data.Book + "</td>";
				if (data.data[i][0].data.Student==document.getElementById("findstudent").value)
					table+= "<td><input type=\"button\" name=\"del\" value= \"Delete Book\" onclick=\"delNode(\'" + data.data[i][0].self + "\')\"/></td>";
				
				table+= "</tr>";

				}
			table += "</table>";
			
			document.getElementById('displaybooks').innerHTML= table;
			}

			
  	</script>

  </head>

  <body>
  	<h1><center>Chelsey's Book Exchange<center></h1>
  	
  	<table width="100%">
  		<tr>
  			<td><center><h2>Have a book to sell?</h2></center></td>
  			<td><center><h2>Looking for a book?</h2></center></td>
  				<tr>
  					<td>
						<table>
						  <tr>
							<td>Student Name:</td>
							<td><input type="text" id="student" name="student" size=20/><td>
						  </tr>
						  
						  <tr>
							<td>Email:</td>
							<td><input type="text" id="email" name="email" size=20/></td>
						  </tr>
						  
						  <tr>
							<td>Class Name:</td>
							<td><input type="text" id="class" name="class" size=20/></td>
						  </tr>
						  
						  <tr>
							<td>Professor:</td>
							<td><input type="text" id="professor" name="professor" size=20/></td>
						  </tr>
						  
						   <tr>
							<td>Book Used:</td>
							<td><input type="text" id="book" name="book" size=20/></td>
						  </tr>
						</table>
						
						<input type="button" name="add" value= "Add Book to Database" onclick="addNode()"/><br/>
						
						
						<div id="makechanges"></div>
					</td>
					
					<td>
						<center>
						<input type="button" name="show" value= "Show All Books" onclick="showNodes()"/><br/><br/>
						
						Book to Find:<input type="text" id="booktofind" name="booktofind" size=20/><input type="button" name="query" value= "Find Book" onclick="queryGraph()"/><br/><br/>
						Your Name:<input type="text" id="findstudent" name="findstudent" size=20/> <input type="button" name="query" value= "Show My Books" onclick="getbyname()"/>
						<br/><br/>
					
			
						<div id="displaybooks"></div>
						</center>
					</td>
				</tr>

  </body>

</html>